import React, { useState } from "react";
import styles from "../../styles/Login.module.css";
import authImg from "../../assets/auth_bg.png";
import { Link, useNavigate } from "react-router-dom";
import axios from "axios";
import Header from "../layout/Header";

function Login() {
  const [formData, setFormData] = useState({
    email: "",
    password: "",
  });
  const [error, setError] = useState("");
  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  const navigate = useNavigate();

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    setIsLoading(true);
    setError("");
    axios
      .post(`${import.meta.env.VITE_API_URL}api/auth/login`, formData)
      .then((response) => {
        if (response.data.success) {
          localStorage.setItem("token", response.data.token);
          localStorage.setItem("user", JSON.stringify(response.data.user));
          navigate("/dashboard");
        }
      })
      .catch((err) => {
        console.log(err.response?.data?.error);
        setError(err.response?.data?.error || "An error occurred");
      })
      .finally(() => {
        setIsLoading(false);
      });
  };

  const togglePasswordVisibility = () => {
    setShowPassword((prev) => !prev);
  };

  return (
    <div className={styles.container}>
      <div className={styles.headerComponent}>
      <svg width="141" height="36" viewBox="0 0 141 36" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.9063 3.43749C21.5391 3.43632 19.2319 4.18186 17.313 5.56798C15.3942 6.9541 13.9614 8.91018 13.2188 11.1578C13.1663 11.3395 13.0778 11.5088 12.9584 11.6556C12.8391 11.8023 12.6913 11.9234 12.5241 12.0117C12.3568 12.1 12.1734 12.1537 11.9849 12.1695C11.7965 12.1853 11.6067 12.1629 11.4271 12.1036C11.2475 12.0444 11.0816 11.9495 10.9395 11.8247C10.7974 11.6999 10.6819 11.5476 10.6 11.3772C10.5181 11.2067 10.4714 11.0214 10.4628 10.8325C10.4541 10.6435 10.4837 10.4547 10.5497 10.2775C11.5259 7.32943 13.4502 4.78724 16.0225 3.04728C18.5947 1.30732 21.6704 0.467377 24.77 0.658413C27.8697 0.84945 30.8189 2.06073 33.1581 4.10339C35.4972 6.14606 37.0947 8.9053 37.7016 11.9509C39.8229 12.2375 41.7561 13.3196 43.1094 14.9781C44.4628 16.6366 45.1351 18.7476 44.9903 20.8833C44.8455 23.019 43.8943 25.0198 42.3295 26.4805C40.7647 27.9411 38.7031 28.7524 36.5625 28.75H12.6563C12.2833 28.75 11.9256 28.6018 11.6619 28.3381C11.3982 28.0744 11.25 27.7167 11.25 27.3437C11.25 26.9708 11.3982 26.6131 11.6619 26.3494C11.9256 26.0856 12.2833 25.9375 12.6563 25.9375H36.5625C38.0543 25.9379 39.4852 25.3456 40.5404 24.2909C41.5955 23.2363 42.1885 21.8057 42.1889 20.3139C42.1893 18.822 41.597 17.3912 40.5424 16.336C39.4878 15.2808 38.0572 14.6879 36.5653 14.6875H36.4922C36.1445 14.6896 35.8084 14.5629 35.5487 14.3317C35.2891 14.1006 35.1242 13.7815 35.0859 13.4359C34.7781 10.6862 33.4678 8.14636 31.4054 6.30187C29.343 4.45738 26.6731 3.43761 23.9063 3.43749ZM0 16.0937C0 15.7208 0.148158 15.3631 0.411881 15.0994C0.675604 14.8356 1.03329 14.6875 1.40625 14.6875H15.4688C15.8417 14.6875 16.1994 14.8356 16.4631 15.0994C16.7268 15.3631 16.875 15.7208 16.875 16.0937C16.875 16.4667 16.7268 16.8244 16.4631 17.0881C16.1994 17.3518 15.8417 17.5 15.4688 17.5H1.40625C1.03329 17.5 0.675604 17.3518 0.411881 17.0881C0.148158 16.8244 0 16.4667 0 16.0937ZM5.625 21.7187C5.625 21.3458 5.77316 20.9881 6.03688 20.7244C6.3006 20.4606 6.65829 20.3125 7.03125 20.3125H32.3438C32.7167 20.3125 33.0744 20.4606 33.3381 20.7244C33.6018 20.9881 33.75 21.3458 33.75 21.7187C33.75 22.0917 33.6018 22.4494 33.3381 22.7131C33.0744 22.9768 32.7167 23.125 32.3438 23.125H7.03125C6.65829 23.125 6.3006 22.9768 6.03688 22.7131C5.77316 22.4494 5.625 22.0917 5.625 21.7187ZM0 32.9687C0 32.5958 0.148158 32.2381 0.411881 31.9744C0.675604 31.7106 1.03329 31.5625 1.40625 31.5625H26.7188C27.0917 31.5625 27.4494 31.7106 27.7131 31.9744C27.9768 32.2381 28.125 32.5958 28.125 32.9687C28.125 33.3417 27.9768 33.6994 27.7131 33.9631C27.4494 34.2268 27.0917 34.375 26.7188 34.375H1.40625C1.03329 34.375 0.675604 34.2268 0.411881 33.9631C0.148158 33.6994 0 33.3417 0 32.9687Z" fill="#184E7F"/>
<path d="M53.2955 29V5.72727H57.5114V15.5795H68.2955V5.72727H72.5227V29H68.2955V19.1136H57.5114V29H53.2955ZM88.0511 21.6591V11.5455H92.1648V29H88.1761V25.8977H87.9943C87.6004 26.875 86.9527 27.6742 86.0511 28.2955C85.1572 28.9167 84.0549 29.2273 82.7443 29.2273C81.6004 29.2273 80.589 28.9735 79.7102 28.4659C78.839 27.9508 78.1572 27.2045 77.6648 26.2273C77.1723 25.2424 76.9261 24.053 76.9261 22.6591V11.5455H81.0398V22.0227C81.0398 23.1288 81.3428 24.0076 81.9489 24.6591C82.5549 25.3106 83.3504 25.6364 84.3352 25.6364C84.9413 25.6364 85.5284 25.4886 86.0966 25.1932C86.6648 24.8977 87.1307 24.4583 87.4943 23.875C87.8655 23.2841 88.0511 22.5455 88.0511 21.6591ZM96.5767 29V5.72727H100.69V14.4318H100.861C101.073 14.0076 101.372 13.5568 101.759 13.0795C102.145 12.5947 102.668 12.1818 103.327 11.8409C103.986 11.4924 104.827 11.3182 105.849 11.3182C107.198 11.3182 108.414 11.6629 109.497 12.3523C110.588 13.0341 111.452 14.0455 112.088 15.3864C112.732 16.7197 113.054 18.3561 113.054 20.2955C113.054 22.2121 112.74 23.8409 112.111 25.1818C111.482 26.5227 110.626 27.5455 109.543 28.25C108.459 28.9545 107.232 29.3068 105.861 29.3068C104.861 29.3068 104.031 29.1402 103.372 28.8068C102.713 28.4735 102.183 28.072 101.781 27.6023C101.387 27.125 101.08 26.6742 100.861 26.25H100.622V29H96.5767ZM100.611 20.2727C100.611 21.4015 100.77 22.3902 101.088 23.2386C101.414 24.0871 101.88 24.75 102.486 25.2273C103.099 25.697 103.842 25.9318 104.713 25.9318C105.622 25.9318 106.384 25.6894 106.997 25.2045C107.611 24.7121 108.073 24.0417 108.384 23.1932C108.702 22.3371 108.861 21.3636 108.861 20.2727C108.861 19.1894 108.705 18.2273 108.395 17.3864C108.084 16.5455 107.622 15.8864 107.009 15.4091C106.395 14.9318 105.63 14.6932 104.713 14.6932C103.834 14.6932 103.088 14.9242 102.474 15.3864C101.861 15.8485 101.395 16.4962 101.077 17.3295C100.766 18.1629 100.611 19.1439 100.611 20.2727ZM120.665 5.72727V29H116.551V5.72727H120.665ZM127.452 35.5455C126.891 35.5455 126.372 35.5 125.895 35.4091C125.425 35.3258 125.05 35.2273 124.77 35.1136L125.724 31.9091C126.323 32.0833 126.857 32.1667 127.327 32.1591C127.796 32.1515 128.209 32.0038 128.565 31.7159C128.929 31.4356 129.236 30.9659 129.486 30.3068L129.838 29.3636L123.509 11.5455H127.872L131.895 24.7273H132.077L136.111 11.5455H140.486L133.497 31.1136C133.171 32.0379 132.74 32.8295 132.202 33.4886C131.664 34.1553 131.005 34.6629 130.224 35.0114C129.452 35.3674 128.527 35.5455 127.452 35.5455Z" fill="#184E7F"/>
</svg>

      </div>
      <div className={styles.formContainer}>
        <div className={styles.formHeaderSignin}>
          <h1>Sign in to your Plexify</h1>
        </div>
        <form className={styles.form} onSubmit={handleSubmit}>
          <label htmlFor="email" className={styles.label}>
            Username
          </label>
          <input
            type="email"
            name="email"
            className={styles.input}
            value={formData.email}
            onChange={handleChange}
            required
            disabled={isLoading}
          />
          <label htmlFor="password" className={styles.label}>
            Password
          </label>
            <input
              type="password"
              name="password"
              className={styles.input}
              value={formData.password}
              onChange={handleChange}
              disabled={isLoading}
              required
            />
          <button type="submit" className={`${styles.btn} ${styles.loginBtn}`}>
            {isLoading ? "Signing in..." : "Sign in"}
          </button>
          <div className={styles.formFooter}>
            
            <p>
            <a href="#">Forgot your password?</a>
            </p>
            <p>
              Don't have an account? <Link to="/signup">Sign up</Link>
            </p>
          </div>
          {error && <p style={{ color: "red" }}>{error}</p>}
        </form>
        <p className={styles.recaptcha}>
          This site is protected by reCAPTCHA and the{" "}
          <a href="#">Google Privacy Policy</a> and{" "}
          <a href="#">Terms of Service</a> apply.
        </p>
      </div>
      <div className={styles.imageContainer}>
        <img src={authImg} alt="auth image bg" />
      </div>
    </div>
  );
}

export default Login;
